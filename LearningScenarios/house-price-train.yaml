---
apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: data-pipeline
  annotations:
    scenarios.ai.sap.com/description: Learning how to ingest data to workflows
    scenarios.ai.sap.com/name: House Price (Tutorial)
    executables.ai.sap.com/description: Train with live data
    executables.ai.sap.com/name: training
    artifacts.ai.sap.com/housedataset.kind: dataset
    artifacts.ai.sap.com/housemodel.kind: model
  labels:
    scenarios.ai.sap.com/id: learning-datalines
    ai.sap.com/version: "2.0"
spec:
  imagePullSecrets:
    - name: credstutorialrepo
  entrypoint: mypipeline
  arguments:
    parameters:
      - name: DT_MAX_DEPTH
        value: "3"
  templates:
    - name: mypipeline
      steps:
        - - name: mypredictor
            template: mycodeblock1
    - name: mycodeblock1
      inputs:
        artifacts:
          - name: housedataset
            path: /app/data/
      outputs:
        artifacts:
          - name: housemodel
            path: /app/model/
      container:
        image: docker.io/chetankommula/house-price:03
        command:
          - /bin/sh
          - -c
        env:
          - name: DT_MAX_DEPTH
            value: "{{workflow.parameters.DT_MAX_DEPTH}}"
        args:
          - cp /argo/inputs/artifacts/housedataset /app/data/train.csv && ls
            /app/data && python /app/src/main.py && ls /app/model
